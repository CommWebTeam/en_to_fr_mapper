<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>change WET file language</title>
<script src="../util/str_format_helpers.js"></script> 
<script src="../util/array_helpers.js"></script> 
<script src="../util/download.js"></script> 
<script src="part1_strip_html.js"></script> 
<script src="part2_replace_en_with_fr.js"></script> 
<script>
unmatchable_string_emptyline = "EMPTYLINEFILLER123456789"
unmatchable_string_placeholder = "FILLER123456789PLACEHOLDER"
script_notify = "SUPERSCRIPTORSUBSCRIPT"

/*
=================================
Part 1 - get content
=================================
*/

// Get uploaded files and download their lists of contents
function create_content_lists() {
	// English
	// read in uploaded file as string
	file_reader_en = new FileReader()
	dirty_file_en = document.getElementById("dirty_en").files[0]
	file_reader_en.onload = function(event) {
		// clean string
		console.log("number of en values:")
		values_en = strip_html(event.target.result)
		// download file
		download(values_en, "en_values.txt", "text/plain")
	}
	file_reader_en.readAsText(dirty_file_en)
	
	// French
	file_reader_fr = new FileReader()
	dirty_fr_file = document.getElementById("dirty_fr").files[0]
	file_reader_fr.onload = function(event) {
		console.log("number of fr values:")
		values_fr = strip_html(event.target.result)
		download(values_fr, "fr_values.txt", "text/plain")
	}
	file_reader_fr.readAsText(dirty_fr_file)
}

/*
=================================
Part 2 - create french structure
=================================
*/
// Get lists of contents and replace English terms with French terms
function create_fr_html() {
	// file inputs - en content and fr content in that order
	content_inputs = ["", ""]
	// read in content files as strings
	// english content
	file_reader_content_en = new FileReader()
	content_str_en = document.getElementById("content_en").files[0]
	file_reader_content_en.onload = function(event) {
		content_inputs[0] = event.target.result
	}
	file_reader_content_en.readAsText(content_str_en)
    // french content
	file_reader_content_fr = new FileReader()
	content_str_fr = document.getElementById("content_fr").files[0]
	file_reader_content_fr.onload = function(event) {
		content_inputs[1] = event.target.result
	}
	file_reader_content_fr.readAsText(content_str_fr)

	// compare english and french contents
	file_reader_en_struct = new FileReader()
	struct_str_en = document.getElementById("cleaned_en").files[0]
	file_reader_en_struct.onload = function(event) {
		// read in english and french contents
		en_contents = content_inputs[0].split("\n")
		fr_contents = content_inputs[1].split("\n")
		// read in english structure
		structure = replace_special_chars(event.target.result)
		structure = rm_extra_space(structure)
		// read in other inputs for matching contents to structure
		min_cont_len = parseInt(document.getElementById("min_content_len").value)
		// replace english content in structure with french content
		new_structure = replace_en_with_fr(structure, en_contents, fr_contents, min_cont_len)
		// download structure with french content
		download(new_structure, "fr_html.html", "text/html")
	}
	file_reader_en_struct.readAsText(struct_str_en)
}
</script>
</head>

<body>
<div>
  <form>
    Dreamweaver-generated English HTML:
    <input id="dirty_en" type="file" />
    <br>
    <br>
    Dreamweaver-generated French HTML:
    <input id="dirty_fr" type="file" />
    <br>
    <br>
  </form>
  <button onclick="create_content_lists()">Download English and French values</button>
</div>
<br>
<br>
<br>
<form>
  Aligned English values generated above:
  <input id="content_en" type="file" />
  <br>
  <br>
  Aligned French values generated above:
  <input id="content_fr" type="file" />
  <br>
  <br>
  WET English HTML:
  <input id="cleaned_en" type="file" />
  <br>
  <br>
  Minimum content length for partial matches (content is found in part of a tag/line, but the tag/line doesn't consist entirely of it):
  <input id="min_content_len" type="number" value="10" />
  times <br>
  <br>
</form>
<button onclick="create_fr_html()">Download WET French HTML</button>
<br>
<br>
<br>
<p>This application tries to fill in the wet French document after the wet English document has been manually completed. It works on the assumptions that a) the original (non-wet) documents have similar document structures and b) the wet html documents should have identical structures. With that in mind, it replaces the English values in the wet html document with their equivalent French values.</p>
<p>This can also be used in reverse if the French document was formatted by wet first.</p>
<p>Steps:</p>
<ol>
  <li>In Word, stop tracking changes.</li>
  <li>Remove filled-in values and formatting from both the English and French word documents (ctrl+6 and ctrl+shift+n - you may want to save copies of the documents before doing this).</li>
  <li>Paste these documents as HTML files into the Dreamweaver design view in separate files.</li>
  <li>Upload these two HTML files below.</li>
  <li>Download the values that are generated (these are the html documents with the tags removed).</li>
  <li>Make sure there are exactly the same number of English and French values (number of values is printed in the console) since the next part matches by index.</li>
  <li>If they don't, manually add blank rows to the shorter document in the positions where the corresponding English and French values don't align. (It's better to add lines to the English content than remove them so you don't miss any matches. Either adding or removing lines is fine for the French content.) Any editor with row numbers is fine for this.</li>
  <li>Upload the values below after you've made sure they align.</li>
  <li>Upload the English document that was formatted by WET standards.</li>
  <li>Download the French document that should now be formatted by WET standards.</li>
  <li>
    <p><strong>Pasting word documents into Dreamweaver does NOT include superscripts and subscripts</strong> - you will have to add these in manually.</p>
    <p>Lines that include &lt;sub&gt; or &lt;sup&gt; have been marked by SUPERSCRIPTORSUBSCRIPT. Go through the document and search for SUPERSCRIPTORSUBSCRIPT to manually add in superscripts and subscripts.</p>
  </li>
  <li>Make sure to double check with beyond compare as usual.</li>
</ol>
<p>Possible todos:</p>
<ol>
  <li>Get rid of Dreamweaver autogenerated links.</li>
  <li>Add the option to add markers before headings for easier beyond comparing.</li>
</ol>
</body>
</html>